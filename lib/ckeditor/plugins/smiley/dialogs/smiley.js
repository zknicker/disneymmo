/*
Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/

CKEDITOR.dialog.add("smiley",function(a){var b=a.config,c=a.lang.smiley,d=b.smiley_images,e=b.smiley_columns||8,f;var g;var h=function(b){var c=b.data.getTarget(),d=c.getName();if(d=="a")c=c.getChild(0);else if(d!="img")return;var e=c.getAttribute("cke_src"),f=c.getAttribute("title");var h=a.document.createElement("img",{attributes:{src:e,"data-cke-saved-src":e,title:f,alt:f,width:c.$.width,height:c.$.height}});a.insertElement(h);g.hide();b.data.preventDefault()};var i=CKEDITOR.tools.addFunction(function(b,c){b=new CKEDITOR.dom.event(b);c=new CKEDITOR.dom.element(c);var d,e;var f=b.getKeystroke(),g=a.lang.dir=="rtl";switch(f){case 38:if(d=c.getParent().getParent().getPrevious()){e=d.getChild([c.getParent().getIndex(),0]);e.focus()}b.preventDefault();break;case 40:if(d=c.getParent().getParent().getNext()){e=d.getChild([c.getParent().getIndex(),0]);if(e)e.focus()}b.preventDefault();break;case 32:h({data:b});b.preventDefault();break;case g?37:39:case 9:if(d=c.getParent().getNext()){e=d.getChild(0);e.focus();b.preventDefault(true)}else if(d=c.getParent().getParent().getNext()){e=d.getChild([0,0]);if(e)e.focus();b.preventDefault(true)}break;case g?39:37:case CKEDITOR.SHIFT+9:if(d=c.getParent().getPrevious()){e=d.getChild(0);e.focus();b.preventDefault(true)}else if(d=c.getParent().getParent().getPrevious()){e=d.getLast().getChild(0);e.focus();b.preventDefault(true)}break;default:return}});var j=CKEDITOR.tools.getNextId()+"_smiley_emtions_label";var k=b.smiley_categories[0];var l=['<div class="cke_smiley_wrapper">'+'<span id="'+j+'" class="cke_voice_label">'+c.options+"</span>",'<div class="cke_smiley_cat"><span>'+k+'</span><ul class="group">'];var m=d.length;for(f=0;f<m;f++){if(k!=b.smiley_categories[f]){k=b.smiley_categories[f];l.push('</ul></div><div class="cke_smiley_cat"><span>'+k+'</span><ul class="group">')}var n="cke_smile_label_"+f+"_"+CKEDITOR.tools.getNextNumber();l.push('<li class="cke_centered" style="vertical-align: middle;">'+'<a href="javascript:void(0)" role="option"',' aria-posinset="'+(f+1)+'"',' aria-setsize="'+m+'"',' aria-labelledby="'+n+'"',' class="cke_smile cke_hand" tabindex="-1" onkeydown="CKEDITOR.tools.callFunction( ',i,', event, this );">','<img class="cke_hand" title="',b.smiley_descriptions[f],'"'+' cke_src="',CKEDITOR.tools.htmlEncode(b.smiley_path+d[f]),'" alt="',b.smiley_descriptions[f],'"',' src="',CKEDITOR.tools.htmlEncode(b.smiley_path+d[f]),'"',CKEDITOR.env.ie?" onload=\"this.setAttribute('width', 2); this.removeAttribute('width');\" ":"",">"+'<span id="'+n+'" class="cke_voice_label">'+b.smiley_descriptions[f]+"</span>"+"</a>","</li>")}l.push("</div></ul></div>");var o={type:"html",id:"smileySelector",html:l.join(""),onLoad:function(a){g=a.sender},focus:function(){var a=this;setTimeout(function(){var b=a.getElement().getElementsByTag("a").getItem(0);b.focus()},0)},onClick:h,style:"width: 100%; border-collapse: separate;"};return{title:a.lang.smiley.title,minWidth:270,minHeight:120,contents:[{id:"tab1",label:"",title:"",expand:true,padding:0,elements:[o]}],buttons:[CKEDITOR.dialog.cancelButton]}})